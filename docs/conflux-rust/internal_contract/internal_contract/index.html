<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">Internal Contract | Conflux</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Internal Contract | Conflux"><meta data-react-helmet="true" name="description" content="Conflux introduces several built-in internal contracts for better system maintenance and on-chain governance. This document will show you how to use these internal contracts."><meta data-react-helmet="true" property="og:description" content="Conflux introduces several built-in internal contracts for better system maintenance and on-chain governance. This document will show you how to use these internal contracts."><meta data-react-helmet="true" name="keywords" content="conflux,contract"><meta data-react-helmet="true" property="og:url" content="https://developer.conflux-chain.org/docs/conflux-rust/internal_contract/internal_contract"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://developer.conflux-chain.org/docs/conflux-rust/internal_contract/internal_contract"><link rel="stylesheet" href="/styles.82d27872.css">
<link rel="preload" href="/styles.76d112c4.js" as="script">
<link rel="preload" href="/runtime~main.5aae6ecd.js" as="script">
<link rel="preload" href="/main.53b98f45.js" as="script">
<link rel="preload" href="/1.ee60868b.js" as="script">
<link rel="preload" href="/2.9ade59a0.js" as="script">
<link rel="preload" href="/61.37f61128.js" as="script">
<link rel="preload" href="/68.8759d59b.js" as="script">
<link rel="preload" href="/20ac7829.f5a1db94.js" as="script">
<link rel="preload" href="/65.ea8dd659.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Conflux-Chain/conflux-developer-site" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_KVdu"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_13On moon_3n_g"></span></div><div class="react-toggle-track-x"><span class="toggle_13On sun_UemI"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/Conflux-Chain/conflux-developer-site" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_3T5V"><div class="docSidebarContainer_1y9o"><div class="sidebar_mAK4"><div class="menu menu--responsive menu_1wyc"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_XNDY" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Learn About Conflux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/en/conflux_overview">Conflux Overview</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Try Conflux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/get_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/send_transaction">My First Transaction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/independent_chain">Run An Independent Chain</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/conflux-rust/internal_contract/internal_contract">Internal Contract</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/json_rpc">JSON RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/pubsub">Publish-Subscribe API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/cli_sub_commands">CLI Sub-commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/js-conflux-sdk/javascript_sdk">Javascript SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/go-conflux-sdk/go_sdk">Golang SDK</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">ConfluxPortal</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/introduction">What Is ConfluxPortal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/Main_Concepts/getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/Main_Concepts/accessing_accounts">Accessing Accounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/Main_Concepts/sending_transactions">Sending Transactions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/API_Reference/provider_api">Portal Provider API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/API_Reference/signing_data_with_portal">Signing Data with ConfluxPortal</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2yiU"><div class="container padding-vert--lg docItemWrapper_182k"><div class="row"><div class="col docItemCol_2uRP"><div class="docItemContainer_1gVo"><article><header><h1 class="docTitle_3r6L">Internal Contract</h1></header><div class="markdown"><p>Conflux introduces several built-in internal contracts for better system maintenance and on-chain governance. This document will show you how to use these internal contracts.</p><p>The following document will use <a href="https://github.com/Conflux-Chain/js-conflux-sdk" target="_blank" rel="noopener noreferrer">js-conflux-sdk</a> as an example.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="sponsorship-for-usage-of-contracts"></a>Sponsorship for Usage of Contracts<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sponsorship-for-usage-of-contracts" title="Direct link to heading">#</a></h2><p>Conflux implements a sponsorship mechanism to subsidize the usage of smart contracts. Thus, a new account with zero balance is able to call smart contracts as long as the execution is sponsored (usually by the operator of Dapps). The built-in SponsorControl contract is introduced to record the sponsorship information of smart contracts.</p><p>The <strong>SponsorControl</strong> contract keeps the following information for each user-established contract:</p><ul><li><code>sponsor_for_gas</code>: this is the account that provides the subsidy for gas consumption;</li><li><code>sponsor_for_collateral</code>: this is the account that provides the subsidy for collateral for storage;</li><li><code>sponsor_balance_for_gas</code>: this is the balance of subsidy available for gas consumption;</li><li><code>sponsor_balance_for_collateral</code>: this is the balance of subsidy available for collateral for storage;</li><li><code>sponsor_limit_for_gas_fee</code>: this is the upper bound for the gas fee subsidy paid for every sponsored transaction;</li><li><code>whitelist</code>: this is the list of normal accounts that are eligible for the subsidy, where a special all-zero address refers to all normal accounts. Only the contract itself has the authority to change this list.</li></ul><p>There are two resources that can be sponsored: gas consumption and storage collateral.</p><ul><li><em>For gas consumption</em>: If a transaction calls a contract with non-empty <code>sponsor_for_gas</code> and the sender is in the <code>whitelist</code> of the contract and the gas fee specified by the transaction is within the <code>sponsor_limit_for_gas_fee</code>, the gas consumption of the transaction is paid from the <code>sponsor_balance_for_gas</code> of the contract (if it is sufficient) rather than from the sender’s balance, and the execution of the transaction would fail if the <code>sponsor_balance_for_gas</code> cannot afford the gas consumption. Otherwise, the sender should pay for the gas consumption.</li><li><em>For storage collateral</em>: If a transaction calls a contract with non-empty <code>sponsor_balance_for_collateral</code> and the sender is in the <code>whitelist</code> of the contract,  the collateral for storage incurred in the execution of the transaction is deducted from <code>sponsor_balance_for_collateral</code> of the contract, and the owner of those modified storage entries is set to the contract address accordingly. Otherwise, the sender should pay for the collateral for storage incurred in the execution.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="sponsorship-update"></a>Sponsorship Update<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sponsorship-update" title="Direct link to heading">#</a></h3><p>Both sponsorship for gas and for collateral can be updated by calling the SponsorControl contract. The current sponsors can call this contract to transfer funds to increase the sponsor balances directly, and the current sponsor for gas is also allowed to increase the <code>sponsor_limit_for_gas_fee</code> without transferring new funds. Other normal accounts can replace the current sponsors by calling this contract and providing more funds for sponsorship.</p><p>To replace the <code>sponsor_for_gas</code> of a contract, the new sponsor should transfer to the contract a fund more than the current <code>sponsor_balance_for_gas</code> of the contract and set a new value for <code>sponsor_limit_for_gas_fee</code>. The new value of <code>sponsor_limit_for_gas_fee</code> should be no less than the old sponsor’s limit unless the old <code>sponsor_limit_for_gas_fee</code> cannot afford the old limit. Moreover, the transferred fund should be &gt;= 1000 times of the new limit, so that it is sufficient to subsidize at least <code>1000</code> transactions calling C. If the above conditions are satisfied, the remaining <code>sponsor_balance_for_gas</code> will be refunded to the old <code>sponsor_for_gas</code>, and then <code>sponsor_balance_for_gas</code>, <code>sponsor_for_gas</code> and <code>sponsor_limit_for_gas_fee</code> will be updated according to the new sponsor’s
specification.</p><p>The replacement of <code>sponsor_for_collateral</code> is similar except that there is no analog of the limit for gas fee. The new sponsor should transfer to C a fund more than the fund provided by the current sponsor for collateral of the contract. Then the current <code>sponsor_for_collateral</code> will be fully refunded, i.e. the sum of <code>sponsor_balance_for_collateral</code> and the total collateral for storage used by the contract, and both collateral sponsorship fields are changed as the new sponsor’s request accordingly. A contract account is also allowed to be a sponsor.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="the-interfaces"></a>The Interfaces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-interfaces" title="Direct link to heading">#</a></h3><p>The built-in contract address is <code>0x0888000000000000000000000000000000000001</code>. The abi for the internal contract could be found <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/metadata/SponsorWhitelistControl.json">here</a> and <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/SponsorWhitelistControl.sol">here</a>.</p><ul><li><code>set_sponsor_for_gas(address contract, uint upper_bound)</code>: If someone wants to sponsor the gas fee for a contract with address <code>contract</code>, he/she (it can be a contract account) should call this function and in the meantime transfer some tokens to the address <code>0x0888000000000000000000000000000000000001</code>. The parameter <code>upper_bound</code> is the upper bound of the gas fee the sponsor will pay for a single transaction. The number of transferred tokens should be at least 1000 times of the <code>upper_bound</code>. The sponsor could be replaced if the new sponsor transfers more tokens and sets a larger upper bound. The current sponsor can also call the function to transfer more tokens to sponsor the contract. The <code>upper_bound</code> can be changed to a smaller one if the current sponsor balance is less than the <code>upper_bound</code>.</li><li><code>set_sponsor_for_collateral(address contract_addr)</code>: If someone wants to sponsor the CFS (collateral for storage) for a contract with address <code>contract</code>, he/she (it can be a contract account) should call this function and in the meantime transfer some tokens to the address <code>0x0888000000000000000000000000000000000001</code>. The sponsor could be replaced if the new sponsor transfers more tokens. The current sponsor can also call the function to transfer more tokens to sponsor the contract.</li><li><code>add_privilege(address[] memory)</code>: A contract can call this function to add some normal account address to the whitelist. It means that if the <code>sponsor_for_gas</code> is set, the contract will pay the gas fee for the accounts in the whitelist, and if the <code>sponsor_for_collateral</code> is set, the contract will pay the CFS (collateral for storage) for the accounts in the whitelist. A special address <code>0x0000000000000000000000000000000000000000</code> could be used if the contract wants to add all account to the whitelist.</li><li><code>remove_privilege(address[] memory)</code>: A contract can call this function to remove some normal account address from the whitelist.</li></ul><p>The transferred value when calling function <code>set_sponsor_for_gas</code> and <code>set_sponsor_for_collateral</code> represents the amount of tokens that the sender (new sponsor) is willing to pay. Every contract maintains its <code>whitelist</code> by calling <code>add_privilege</code> and <code>remove_privilege</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="examples"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples" title="Direct link to heading">#</a></h3><p>Suppose you have a simple contract like this.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-solidity codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity &gt;=0.4.15;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &quot;https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/SponsorWhitelistControl.sol&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract CommissionPrivilegeTest {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mapping(uint =&gt; uint) public ss;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function add(address account) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x0888000000000000000000000000000000000001);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        address[] memory a = new address[](1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a[0] = account;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cpc.add_privilege(a);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function remove(address account) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x0888000000000000000000000000000000000001);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        address[] memory a = new address[](1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a[0] = account;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cpc.remove_privilege(a);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function foo() public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function par_add(uint start, uint end) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        for (uint i = start; i &lt; end; i++) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ss[i] = 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>After deploying the contract and the address is <code>contract_addr</code>, if someone wants to sponsor the gas consumption, he/she can send a transaction like below:</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://testnet-jsonrpc.conflux-chain.org:12537&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGasPrice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sponsor_contract_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0x0888000000000000000000000000000000000001&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sponsor_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./contracts/sponsor.abi.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sponsor_contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sponsor_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">set_sponsor_for_gas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> your_upper_bound</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> your_sponsor_value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>As for sponsor the storage collateral, you can simply replace the function <code>set_sponsor_for_gas(contract_addr, your_upper_bound)</code> to <code>set_sponsor_for_collateral(contract_addr)</code>.</p><p>After that you can maintain the <code>whitelist</code> for your contract using <code>add_privilege</code> and <code>remove_privilege</code>. The special address <code>0x0000000000000000000000000000000000000000</code> with all zeros means everyone is in the <code>whitelist</code>. You need to use it carefully.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">you_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">white_list_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">you_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">white_list_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>After that the accounts in <code>whiltelist</code> will pay nothing while calling <code>you_contract.foo()</code> or <code>you_contract.par_add(1, 10)</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="admin-management"></a>Admin Management<a aria-hidden="true" tabindex="-1" class="hash-link" href="#admin-management" title="Direct link to heading">#</a></h2><p>The <strong>AdminControl</strong> contract is introduced for better maintenance of other smart contracts, especially which are generated tentatively without a proper destruction routine: it records the administrator of every user-established smart contract and handles the destruction on request of corresponding administrators.</p><p>The default administrator of a smart contract is the creator of the contract, i.e. the sender α of the transaction that causes the creation of the contract. The current administrator of a smart contract can transfer its authority to another normal account by sending a request to the AdminControl contract. Contract accounts are not allowed to be the administrator of other contracts, since this mechanism is mainly for tentative maintenance. Any long term administration with customized authorization rules should be implemented inside the contract, i.e. as a specific function that handles destruction requests.</p><p>At any time, the administrator <code>addr</code> of an existing contract has the right to request destruction of the contract by calling AdminControl. However, the request would be rejected if the collateral for storage of contract is not zero, or <code>addr</code> is not the current administrator of the contract. If <code>addr</code> is the current administrator of the contract and the collateral for storage of contract is zero, then the destruction request is accepted and
processed as follows:</p><ol><li>the balance of the contract will be refunded to <code>addr</code>;</li><li>the <code>sponsor_balance_for_gas</code> of the contract will be refunded to <code>sponsor_for_gas</code>;</li><li>the <code>sponsor_balance_for_collateral</code> of the contract will be refunded to <code>sponsor_for_collateral</code>;</li><li>the internal state in the contract will be released and the corresponding collateral for storage refunded to owners;</li><li>the contract is deleted from world-state.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="the-interfaces-1"></a>The Interfaces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-interfaces-1" title="Direct link to heading">#</a></h3><p>The contract address is <code>0x0888000000000000000000000000000000000000</code>. The abi for the internal contract could be found <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/metadata/AdminControl.json">here</a> and <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/AdminControl.sol">here</a>.</p><ul><li><p><code>set_admin(address contract, address admin)</code>: Set the administrator of contract <code>contract</code> to <code>admin</code>. The caller should be the administrator of <code>contract</code> and it should be a normal account. The caller should make sure that <code>contract</code> should be an address of a contract and <code>admin</code> should be a normal account address. Otherwise, the call will fail.</p></li><li><p><code>destroy(address contract)</code>: Perform a suicide of the contract <code>contract</code>. The caller should be the administrator of <code>contract</code> and it should be a normal account. If the collateral for storage of the contract is not zero, the suicide will fail. Otherwise, the <code>balance</code> of <code>contract</code> will be refunded to the current administrator, the <code>sponsor_balance_for_gas</code> will be refunded to <code>sponsor_for_gas</code>, the <code>sponsor_balance_for_collateral</code> will be refunded to <code>sponsor_for_collateral</code>.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="examples-1"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples-1" title="Direct link to heading">#</a></h3><p>Consider you have deployed a contract whose address is <code>contract_addr</code>. The administrator can call <code>AdminControl.set_admin(contract_addr, new_admin)</code> to change the administrator and call <code>AdminControl.destroy(contract_addr)</code> to kill the contract. </p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://testnet-jsonrpc.conflux-chain.org:12537&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGasPrice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> admin_contract_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0x0888000000000000000000000000000000000000&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> admin_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./contracts/admin.abi.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> admin_contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to change administrator</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">set_admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> new_admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to kill the contract</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="staking-mechanism"></a>Staking Mechanism<a aria-hidden="true" tabindex="-1" class="hash-link" href="#staking-mechanism" title="Direct link to heading">#</a></h2><p>Conflux introduces the staking mechanism for two reasons: first, staking mechanism provides a better way to charge the occupation of storage space (comparing to “pay once, occupy forever”); and second, this mechanism also helps in defining the voting power in decentralized governance.</p><p>At a high level, Conflux implements a built-in <strong>Staking</strong> contract to record the staking information of all accounts. By sending a transaction to this contract, users (both external users and smart contracts) can deposit/withdraw funds, which is also called stakes in the contract. The interest of staked funds is issued at withdrawal, and depends on both the amount and staking period of the fund being withdrawn</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="interest-rate"></a>Interest Rate<a aria-hidden="true" tabindex="-1" class="hash-link" href="#interest-rate" title="Direct link to heading">#</a></h3><p>The staking interest rate is currently set to 4% per year. Compound interest is implemented in the granularity of blocks.</p><p>When executing a transaction sent by account <code>addr</code> at block <code>B</code> to withdraw a fund of value <code>v</code> deposited at block <code>B&#x27;</code>, the interest is calculated as follows:</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">interest issued = v * (4% / 63072000)^T</span></div></div></div></div></div><p>where <code>T = BlockNo(B)−BlockNo(B&#x27;)</code> is the staking period measured by the number of blocks, and <code>63072000</code> is the expected number of blocks generated in <code>365</code> days with the target block time <code>0.5</code> seconds.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="staking-for-voting-power"></a>Staking for Voting Power<a aria-hidden="true" tabindex="-1" class="hash-link" href="#staking-for-voting-power" title="Direct link to heading">#</a></h3><p>See the details in <a href="https://confluxnetwork.org/developer/" target="_blank" rel="noopener noreferrer">Conflux Protocol Specification</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="the-interfaces-2"></a>The Interfaces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-interfaces-2" title="Direct link to heading">#</a></h3><p>The contract address is <code>0x0888000000000000000000000000000000000002</code>. The abi for the internal contract could be found <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/metadata/Staking.json">here</a> and <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/Staking.sol">here</a>.</p><ul><li><code>deposit(uint amount)</code>: The caller can call this function to deposit some tokens to the Conflux Internal Staking Contract. The current annual interest rate is 4%.</li><li><code>withdraw(uint amount)</code>: The caller can call this function to withdraw some tokens from the Conflux Internal Staking Contract. This will also trigger interest settlement. The staking capital and staking interest will be transferred to the user&#x27;s balance in time. All the withdrawal applications will be processed on a first-come-first-served basis according to the sequence of staking orders.</li><li><code>vote_lock(uint amount, uint unlock_block_number)</code>: This function is related with Voting Rights in Conflux. Staking users can choose the voting amount and locking maturity by locking a certain amount of CFX in a certain maturity from staking. The <code>unlock_block_number</code> is measured in the number of blocks since genesis block.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="examples-2"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples-2" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://testnet-jsonrpc.conflux-chain.org:12537&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGasPrice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> staking_contract_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0x0888000000000000000000000000000000000002&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> staking_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./contracts/staking.abi.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> staking_contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// deposit some amount of tokens</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">deposit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// withdraw some amount of tokens</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">withdraw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// lock some tokens until some block number</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">vote_lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> your_unlock_block_number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Conflux-Chain/conflux-rust/edit/master/internal_contract/README.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-07-21T13:48:15.000Z" class="docLastUpdatedAt_2pXX">7/21/2020</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/conflux-doc/docs/independent_chain"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Run An Independent Chain</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/conflux-doc/docs/json_rpc"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">JSON RPC »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_1Fsi"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sponsorship-for-usage-of-contracts" class="table-of-contents__link">Sponsorship for Usage of Contracts</a><ul><li><a href="#sponsorship-update" class="table-of-contents__link">Sponsorship Update</a></li><li><a href="#the-interfaces" class="table-of-contents__link">The Interfaces</a></li><li><a href="#examples" class="table-of-contents__link">Examples</a></li></ul></li><li><a href="#admin-management" class="table-of-contents__link">Admin Management</a><ul><li><a href="#the-interfaces-1" class="table-of-contents__link">The Interfaces</a></li><li><a href="#examples-1" class="table-of-contents__link">Examples</a></li></ul></li><li><a href="#staking-mechanism" class="table-of-contents__link">Staking Mechanism</a><ul><li><a href="#interest-rate" class="table-of-contents__link">Interest Rate</a></li><li><a href="#staking-for-voting-power" class="table-of-contents__link">Staking for Voting Power</a></li><li><a href="#the-interfaces-2" class="table-of-contents__link">The Interfaces</a></li><li><a href="#examples-2" class="table-of-contents__link">Examples</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/en/conflux_overview">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/conflux-portal/docs/en/portal/introduction">Portal</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://bounty.conflux-chain.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bounty</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Conflux-Chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/Conflux_Network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Conflux Chain, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.76d112c4.js"></script>
<script src="/runtime~main.5aae6ecd.js"></script>
<script src="/main.53b98f45.js"></script>
<script src="/1.ee60868b.js"></script>
<script src="/2.9ade59a0.js"></script>
<script src="/61.37f61128.js"></script>
<script src="/68.8759d59b.js"></script>
<script src="/20ac7829.f5a1db94.js"></script>
<script src="/65.ea8dd659.js"></script>
</body>
</html>